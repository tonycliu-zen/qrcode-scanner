<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana Scanner</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            /* é¦™è•‰ä¸»é¡Œé…è‰² */
            --primary-yellow: #ffd54f;    /* æˆç†Ÿé¦™è•‰é»ƒ */
            --accent-yellow: #ffecb3;     /* é¦™è•‰è‚‰è‰² */
            --dark-brown: #5d4037;        /* é¦™è•‰è’‚é ­/æ–‡å­—è‰² */
            --card-bg: #ffffff;
            --bg-color: #fffde7;          /* æ·¡æ·¡çš„å¥¶æ²¹é»ƒèƒŒæ™¯ */
        }

        body {
            font-family: 'Varela Round', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            
            /* é€™è£¡æ˜¯ç”¨ç¨‹å¼ç¢¼ç•«å‡ºçš„å¯æ„›é¦™è•‰èƒŒæ™¯åœ–æ¡ˆ */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='50%25' y='50%25' font-size='24' text-anchor='middle' dominant-baseline='middle' transform='rotate(-15, 30, 30)' opacity='0.15'%3EğŸŒ%3C/text%3E%3C/svg%3E");
            
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: var(--dark-brown);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 10px rgba(93, 64, 55, 0.1);
            border: 2px solid var(--primary-yellow);
        }

        h1 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header p {
            margin: 5px 0 0;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* æƒæå™¨å¤–æ¡† */
        .scanner-wrapper {
            width: 100%;
            max-width: 360px;
            background: var(--card-bg);
            padding: 12px;
            border-radius: 24px;
            box-shadow: 0 8px 20px rgba(93, 64, 55, 0.15);
            border: 4px solid var(--primary-yellow);
            position: relative;
        }

        #reader {
            width: 100%;
            border-radius: 16px;
            overflow: hidden;
        }
        
        /* éš±è—å¤šé¤˜æ–‡å­— */
        #reader__dashboard_section_csr span { display: none !important; }

        /* çµæœå¡ç‰‡ */
        #result-card {
            width: 100%;
            max-width: 360px;
            background: var(--card-bg);
            margin-top: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(93, 64, 55, 0.1);
            padding: 20px;
            box-sizing: border-box;
            display: none;
            border-top: 5px solid var(--primary-yellow);
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .result-label {
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--dark-brown);
            opacity: 0.6;
            letter-spacing: 1px;
            margin-bottom: 8px;
            text-align: center;
        }

        .result-content {
            font-size: 1.1rem;
            word-break: break-all;
            background: var(--bg-color);
            padding: 15px;
            border-radius: 12px;
            border: 2px dashed var(--primary-yellow); /* è™›ç·šé‚Šæ¡†æ›´å¯æ„› */
            margin-bottom: 20px;
            color: var(--dark-brown);
            text-align: center;
            font-weight: bold;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn {
            border: none;
            padding: 14px;
            border-radius: 14px; /* åœ“æ½¤ä¸€é» */
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            text-decoration: none;
            transition: transform 0.1s;
            color: var(--dark-brown);
        }

        .btn:active { transform: scale(0.95); }

        .btn-primary {
            background-color: var(--primary-yellow);
            box-shadow: 0 4px 0 #fbc02d; /* ç«‹é«”æ„ŸæŒ‰éˆ•åº•éƒ¨ */
        }
        .btn-primary:active { box-shadow: 0 2px 0 #fbc02d; transform: translateY(2px); }

        .btn-secondary {
            background-color: #eee;
            box-shadow: 0 4px 0 #e0e0e0;
        }
        .btn-secondary:active { box-shadow: 0 2px 0 #e0e0e0; transform: translateY(2px); }

        .btn-copy {
            background-color: #a5d6a7; /* æŸ”å’Œç¶  */
            box-shadow: 0 4px 0 #81c784;
        }
        .btn-copy:active { box-shadow: 0 2px 0 #81c784; transform: translateY(2px); }

        .btn-full { grid-column: span 2; }
        .material-icons { font-size: 20px; }
    </style>
</head>
<body>

    <div class="header">
        <h1><span>ğŸŒ</span> Banana Scan</h1>
        <p>Nano Pro Edition</p>
    </div>

    <div class="scanner-wrapper">
        <div id="reader"></div>
    </div>

    <div id="result-card">
        <div class="result-label">âœ¨ ç™¼ç¾å…§å®¹ âœ¨</div>
        <div id="result-text" class="result-content"></div>
        
        <div class="btn-group" id="action-buttons"></div>
        
        <div style="margin-top: 12px;">
            <button onclick="resetScanner()" class="btn btn-secondary btn-full">
                <span class="material-icons">refresh</span> æƒä¸‹ä¸€å€‹
            </button>
        </div>
    </div>

    <script>
        // --- é‚è¼¯éƒ¨åˆ†ä¿æŒä¸è®Šï¼Œæ¨£å¼å·²å…¨é¢å‡ç´š ---
        const html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { fps: 10, qrbox: 250 }, false
        );

        let currentDecodedText = "";

        function isUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === "http:" || url.protocol === "https:";
            } catch (_) { return false; }
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(currentDecodedText).then(() => {
                const copyBtn = document.getElementById('copy-btn');
                const originalHtml = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="material-icons">check</span> OK!';
                setTimeout(() => { copyBtn.innerHTML = originalHtml; }, 2000);
            });
        }

        function onScanSuccess(decodedText) {
            if (decodedText === currentDecodedText) return;
            currentDecodedText = decodedText;
            html5QrcodeScanner.pause();

            const resultCard = document.getElementById('result-card');
            document.getElementById('result-text').innerText = decodedText;
            const actionButtons = document.getElementById('action-buttons');
            actionButtons.innerHTML = '';

            const copyBtn = document.createElement('button');
            copyBtn.id = 'copy-btn';
            copyBtn.className = 'btn btn-copy';
            copyBtn.innerHTML = '<span class="material-icons">content_copy</span> è¤‡è£½';
            copyBtn.onclick = copyToClipboard;
            
            if (isUrl(decodedText)) {
                const linkBtn = document.createElement('a');
                linkBtn.href = decodedText;
                linkBtn.target = "_blank";
                linkBtn.className = 'btn btn-primary';
                linkBtn.innerHTML = '<span class="material-icons">rocket_launch</span> å‰å¾€';
                actionButtons.appendChild(copyBtn);
                actionButtons.appendChild(linkBtn);
            } else {
                copyBtn.classList.add('btn-full');
                actionButtons.appendChild(copyBtn);
            }

            resultCard.style.display = 'block';
            resultCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function resetScanner() {
            document.getElementById('result-card').style.display = 'none';
            currentDecodedText = "";
            html5QrcodeScanner.resume();
        }

        html5QrcodeScanner.render(onScanSuccess, () => {});
    </script>
</body>
</html>
